<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Settings - Discord Bot Studio</title>
        <link rel="stylesheet" href="nodes/mb.css" />
        <link rel="stylesheet" href="css/bootstrap-grid.min.css" />
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <link rel="stylesheet" href="css/styles.css" /> 
    </head>
    <body>
        <nav class="navbar navbar-expand-md navbar-dark bg-primary mb-2">
            <a class="navbar-brand" href="#">Settings</a>
            <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#navbarColor02"
                aria-expanded="false"
                aria-label="Toggle navigation"
            >
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarColor02">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="run.html">Run Bot</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="choose.html">Choose Bot</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="settings.html">Setup</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="nodes/ui.html">Commands</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="nodes/node_events.html">Events</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="rules.html">Rules</a>
                    </li>
                </ul>
            </div>
        </nav>
        
        <div class="container" style="padding-top: 15px;">
            <h3>Settings</h3>
            <p>General settings for DBS</p>

            <div>
                <h4>Themes</h4>
                <div class="list-group" id="themes">
                    <a href="#" id="openthemes" class="list-group-item list-group-item-action">
                        <h5 class="text-center">Open themes folder</h5>
                    </a>
                </div>
            </div>

            <!--<hr>

            <div>
                <h4>Plugins <span class="badge bg-primary text-light">Beta</span></h4>
                <div class="list-group" id="plugins">
                    <a href="#" id="openplugins" class="list-group-item list-group-item-action">
                        <h5 class="text-center">Open plugins folder</h5>
                    </a>
                </div>
            </div> -->

            <br>

            <small class="center" id="texta">made with ‚ù§ by qizzle Schnitzel#0020</small>
            
        </div>
        <script>
            window.$ = window.jQuery = require("jquery");
        </script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script>
            const fs = require('fs');
            const path = require('path');
            let themedir = fs.readdirSync(path.join(__dirname, "..", "bdbs/themes"));
            let plugindir = fs.readdirSync(path.join(__dirname, "..", "bdbs/plugins"));
            var settings = JSON.parse(fs.readFileSync(path.join(__dirname, "..", "bdbs/settings/settings.json")));

            async function changeTheme(theme) {
                console.log("BDBS: Changed theme to " + theme + "!")
                var css = fs.readFileSync(path.join(__dirname, "..", "bdbs/themes", theme));
                await fs.writeFileSync(path.join(__dirname, "/nodes/mb.css"), css);
                let json = {
                    theme: theme.split(".")[0]
                }
                await fs.writeFileSync(path.join(__dirname, "..", "bdbs/settings/settings.json"), JSON.stringify(json));
                window.location.reload();
            };

            for (let i = 0; i < themedir.length; i++) {
                const v = themedir[i];
                if (v.endsWith(".css")) {
                    const config = `${v.split(".")[0]}.theme.json`;
                    if (themedir.includes(config)) {
                        var data = JSON.parse(fs.readFileSync(path.join(__dirname, "..", "bdbs/themes", config)));
                        console.log('BDBS: Loaded ' + data.title + ' Theme!');
                    };
                    if (settings.theme == v.split(".")[0]) {
                        $('#themes').prepend(
                            `<a href="#" class="list-group-item list-group-item-action active"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1">${data.title}</h5></div><p class="mb-1">${data.description}</p><small>By ${data.author}</small></a>`
                        );
                    } else {
                        $('#themes').prepend(
                            `<a href="#" onclick="changeTheme('${v}')" class="list-group-item list-group-item-action"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1" id="clickedTheme">${data.title}</h5></div><p class="mb-1">${data.description}</p><small>By ${data.author}</small></a>`
                        );
                    };
                };
            };

            for (let i = 0; i < plugindir.length; i++) {
                const v = plugindir[i];
                var data = {};
                if (v.endsWith(".plugin.js")) {
                    require(path.join(__dirname, "..", "bdbs/plugins", v)).execute(data);
                    console.log('BDBS: Loaded ' + data.title + ' Plugin!');
                    $('#plugins').prepend(`<div class="list-group-item"><div class="d-flex w-100 justify-content-between"><h5 class="mb-1">${data.title}</h5></div><p class="mb-1">${data.description}</p><div class="d-flex w-100 justify-content-between"><small class="text-muted">By ${data.author}</small><small class="text-muted">${data.version}</small></div></div>`
                    );
                };
            };

            const { shell } = require('electron');
            function openExplorer(path) {
                shell.openPath(path);
            };

            $("#openthemes").click(function() {
                openExplorer(path.join(__dirname, "..", "bdbs/themes"))
            });
            $("#openplugins").click(function() {
                openExplorer(path.join(__dirname, "..", "bdbs/plugins"))
            });
            

        </script>
    </body>
</html>
